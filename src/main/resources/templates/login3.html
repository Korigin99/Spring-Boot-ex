<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DnB Code Sign Up</title>
<style>
body{
	width: 100%;
    height: 100vh;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: row;
}
div {
	width: 400px;
    height: 600px;
    margin: 0 auto;
    display: flex;
    justify-content: space-around;
    flex-direction: column;
    background: rgb(255, 255, 128);
    border: 1px solid black;
}
h2{
	width: 300px;
    margin: 0 auto;
    display: flex;
    justify-content: center;
}
input{
	width: 200px;
	height:30px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    flex-wrap: nowrap;
    justify-content: center;
    align-content: center;
	text-align: center;
	border: 1px solid black;
}
button{
	width: 200px;
	height: 30px;
	margin: 0 auto;
	border: 1px solid black;
	background: yellow;
	font-weight: bold;
    font-size: 15px;
}
button:hover{
	background : lightpink;
	cursor: pointer;
}

</style>
</head>
<body>
	<div>
		<h2>ë””ì—”ë¹„ì½”ë“œ íšŒì›ê°€ì…</h3>
		<input id="userId" type="text" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.">
		<button type="button" onclick="doCheck()">ì•„ì´ë”” ì¶©ë³µ ì²´í¬</button>
		<input id="userName" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.">
		<input id="userPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.">
		<button type="button" onclick="doJoin()">íšŒì›ê°€ì…</button>
	</div>
	
	<div>
		<h2>ë””ì—”ë¹„ì½”ë“œ ë¡œê·¸ì¸</h3>
		<input id="i_userId" type="text" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.">
		<input id="i_userPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.">
		<button type="button" onclick="doLogin()">ë¡œê·¸ì¸</button>
	</div>
</body>
<script src="https://code.jquery.com/jquery-3.6.1.js"
	integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
	crossorigin="anonymous"></script>
<script type="text/javascript">
	
	var isCheck = false;
	
	// ì•„ì´ë”” ì¤‘ë³µ ì²´í¬ : ì´ë¯¸ ê°€ì…ëœ ì•„ì´ë”” ì°¾ê¸°
	function doCheck(){
      var id = $('#userId').val();
      
      $.ajax({
			url : '/api/v1/users/'+id,
			type : 'GET',
			dataType : 'json',
			success : function(response) {
				//trueë©´ ì´ë¯¸ ê°€ì…í•œ ì•„ì´ë””ê°€ ì¡´ì¬!
				if(response){
					alert("ì´ë¯¸ ê°€ì…ëœ ì•„ì´ë””ì…ë‹ˆë‹¤!ğŸ˜£ğŸ˜£");
					return false;
				}else{
					alert("ì‚¬ìš©ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.ğŸ˜‰ğŸ˜‰");
					isCheck = true;
					return false;
				}
			}
		});
   }

	function doJoin(){
		//ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•´ì„œ ë¹ˆì¹¸ ì²´í¬í•˜ê¸°
		
		var userId = $("#userId").val();
		var userName = $('#userName').val();
		var userPw = $('#userPw').val();
		
		if (userId == ''){
			alert("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”..ğŸ˜ˆğŸ˜ˆ");
			$("#userId").focus();
			return;
		};
		if (userName == ''){
			alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”..ğŸ˜ˆğŸ˜ˆ");
			$("#userName").focus();
			return;
		};
		if (userPw == ''){
			alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”..ğŸ˜ˆğŸ˜ˆ");
			$('#userPw').focus();
			return;
		};
		
		
		var jsonData = {
			"id" : userId,
			"name" : userName,
			"pw" : userPw
		};
		
		$.ajax({
			url : '/api/v1/login3/join',
			type : 'POST',
			contentType : 'application/json', //ì„œë²„ì— json íƒ€ì…ìœ¼ë¡œ ë³´ë‚¼ ì˜ˆì •(ìš”ì²­) 
			data : JSON.stringify(jsonData),
			dataType : 'json',
			success : function(response) {
				console.log(response);
				alert("ë””ì—”ë¹„ì½”ë“œì— ì˜¤ì‹ ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!ğŸ‰");
				location.reload(); //ê°•ì œ ìƒˆë¡œê³ ì¹¨
			}
		});
	}
	
	function doLogin(){
		var id = $('#i_userId').val();
		var pw = $('#i_userPw').val();
		
		var jsonData = {
			"id" : id,
			"pw" : pw
		};
		
		$.ajax({
        	url : '/api/v1/login',
        	type : 'POST',
        	contentType : 'application/json', //ì„œë²„ì— json íƒ€ì…ìœ¼ë¡œ ë³´ë‚¼ ì˜ˆì •(ìš”ì²­) 
        	data : JSON.stringify(jsonData),
        	dataType : 'json',
			success : function(response) {
				if(response.user){
					//í˜ì´ì§€ ì´ë™ ë¡œì§êµ¬í˜„ ì˜ˆì •
					alert(response.name + "ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤. ğŸ‰ğŸ‰");
					location.href = '/users';
				}else{
					alert("ì•„ì´ë”” í˜¹ì€ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
				}
			}
        });
	}
	
	function dosumit(data){
		console.log(data);
		
		$.ajax({
        	url : '/api/v1/login3',
        	type : 'POST',
        	contentType : 'application/json', //ì„œë²„ì— json íƒ€ì…ìœ¼ë¡œ ë³´ë‚¼ ì˜ˆì •(ìš”ì²­) 
        	data : JSON.stringify(jsonData),
        	dataType : 'json',
			success : function(response) {
				console.log(response);
			}
        });
	}
	
</script>

</html>